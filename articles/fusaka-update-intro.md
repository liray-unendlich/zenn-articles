---
title: "今年12月に来るEthereumの大型アップデート、「Fusaka」のポイントを押さえる"
emoji: "😎"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["ethereum", "update", "fusaka"]
published: false
publication_name: omakase
---

## 本記事の概要

2025年12月3日にEthereum メインネットへのリリースが予定されている、"Fusaka"アップデート(Consensus Layer(CL)側のアップデートが"Fulu"、Execution Layer(EL)側のアップデートが"Osaka")について、バリデータ・フルノードの運用に携わる方・L2及びスマートコントラクトの開発者に向け、本アップデートの技術的詳細と実務的影響を解説します。

## Fusaka アップデートの概要とタイムライン

### 目的と打ち手

本アップデートは、2025年5月のPectraに続く大型アップデートで、次を達成することを目標に開発されています。

1. レイヤー2におけるデータ可用性のスケーリング

- PeerDASを導入することで、Blob数の上限を最大8倍まで拡大（理論値）
- L2のトランザクション(TX)手数料を削減

1. レイヤー1のTX処理性能の改善

- ブロックのデフォルトガスリミットを45Mから60Mへ上昇
- 多数のTXを発出するようなDoS攻撃の防止のため、TX単位でガス消費に上限を導入

1. ノードの運用コスト削減

- PeerDASによるストレージ要求性能の低減

1. UXと開発者体験の向上

- 新規オペコードの追加による、ZKP等特定ユースケースにおいて実装・ガスコストを削減
- スマートコントラクトの容量上限を2倍(48kB)に緩和

1. セキュリティと将来性の担保

- Blob Parameter Only フォーク(BPOフォーク)により、段階的なBlobのスケーリング実現
- ブロックプロポーザーを前エポックで確定

Ethereumで掲げられている、 [Lean Ethereum ロードマップ](https://leanroadmap.org)にも整合しており、将来的な変更の下準備としての側面が大きいです。

### 対象となるEIPの一覧

本アップデートは、以下表の12本のEIPによって構成されます。

| 種類                   | EIP番号  | 名称                                                   | 主な機能                                                                                                                                  |
| ---------------------- | -------- | ------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------- |
| スケーラビリティ関連   | EIP-7594 | PeerDAS                                                | P2Pのデータ可用性サンプリング機能。ノードはBlobデータのうち1/8のみを取得し、符号化により8倍のBlobスケーリングを可能にする                 |
| スケーラビリティ関連   | EIP-7892 | Blob Parameter Only ハードフォーク                     | Blob関連の設定のみを修正可能とする、軽量版のハードフォーク機能(6/9から10/15、14/21へと段階的に増加）                                      |
| 容量・セキュリティ関連 | EIP-7935 | デフォルトガスリミットを60Mに設定                      | デフォルトガスリミットを45Mから60Mへ引き上げ                                                                                              |
| 容量・セキュリティ関連 | EIP-7825 | トランザクションごとのガスリミット上限                 | 単一トランザクションを16,777,216ガス（=2^24ガス）に制限してDoS防止                                                                        |
| 容量・セキュリティ関連 | EIP-7907 | コントラクトサイズの計測及び上限の緩和                 | コントラクトコードサイズを24KBから48KBへ増加（24KBの超過分はガス費用増加）                                                                |
| 容量・セキュリティ関連 | EIP-7934 | ブロックへのバイト単位サイズ上限の設定                 | CLのブロック伝搬プロトコルの制限に合わせ、ブロックの容量を最大10MiBに制限                                                                 |
| オペレーション最適化   | EIP-7823 | MODEXPへの入力値上限設定                               | MODEXPのプレコンパイルコントラクトに1024バイトの入力値制限をつけ、バグ等の低減                                                            |
| オペレーション最適化   | EIP-7883 | MODEXPのガスコスト増加                                 | MODEXPのプレコンパイルコントラクトについて、ベースコストを引き上げ、実際のリソース利用に応じた価格設定に修正                              |
| オペレーション最適化   | EIP-7918 | ブロックのベースガス料金とBlobベース料金を連動         | Blobのベース料金を当該ブロックのベースガス料金に比例させ、実際のその時点でのリソース利用に応じた価格設定に修正                            |
| オペレーション最適化   | EIP-7917 | ブロックプロポーザーの事前決定                         | 次エポックのブロックプロポーザーを事前に確定し、信頼性の高いスケジューリングを実現                                                        |
| 開発者ツール           | EIP-7939 | CLZオペコードの追加                                    | CLZ(先頭からゼロをカウントする)命令を追加し、SP1/RiscZeroのようなゼロ知識証明の計算コストを低減                                           |
| 開発者ツール           | EIP-7951 | secp256r1のプレコンパイルコントラクトの追加            | 既存のRIP-7212における P-256曲線のネイティブサポート（コントラクトアドレス0x100）のセキュリティバグ修正を行い・ガスコストを最適化         |
| データ管理             | EIP-7642 | eth/69にブロック範囲記載の追加、不要なデータ項目の削除 | eth/69でのノード間通信において、ノードが提供できるブロック範囲を記載し、基本使われていなかったデータ項目(Bloom)を削除し、帯域幅利用を削減 |
| サポート/情報提供EIP   | EIP-7910 | eth_config JSON-RPC メソッド                           | フォーク状況の確認・ノードのアップデート状況の確認を容易化                                                                                |
| サポート/情報提供EIP   | EIP-7607 | FusakaスコープのメタEIP                                | Fusakaアップデートで扱う範囲・対象を定義                                                                                                  |

## 新技術 **PeerDAS**

### PeerDASの概要

**EIP-7594: PeerDAS（データ可用性サンプリング）** は、P2Pネットワーク層にDAS(データ可用性サンプリング)機能を統合する提案です。Pectraに含まれていた、EIP-4844（Proto-Danksharding）で導入されたBlobデータ(128 KB)の検証をしやすくすることを目的としています。ノード間でBlob保管責任を分散させ、全ノードに全データをダウンロードさせることをコンセンサスルールとせず、確率的にデータ可用性を検証できるようにします。下図は、PeerDASが実装されたのち、Blobごとにどのようにノードが処理することになるかを示した概略図です。

![PeerDAS概要](/images/peerdas01.png)

### 技術的詳細

以下の前提に応じて、ノードの処理とコンセンサスモデルを説明します。
前提は次の通りです。

- 1ブロック内には最大48個のBlobデータが存在する
- 1Blob(最大128kB)を64に分割し、セル(最大2kB)と呼ぶ
- セルあたりに消失訂正符号を付加し、合計128セルとする

以下の流れで説明します。

1. Blobの分割とノードへの割り当て
1. コンセンサスのステップに従ったノードのPeerDAS処理

#### Blobの分割とノードへの割り当て

1Blobあたり、2kBを1セルとして分割したのち、セルに同容量の消失訂正符号を付加することで、1Blobを128セル(2kB)に分割します。
例えば、6Blobがある場合は、全体を6行128列の行列として解釈されます。

![Blobの分割](/images/peerdas02.png)

それぞれの列をSubnetと呼称し、ETHのステーク量に応じて、Blobの数ではなく指定されたSubnet数だけ、Blobデータのダウンロード・検証・保管・P2Pでの発出が必要となります。なお、それぞれのノードの担当するsubnet IDは、NodeID・担当Subnet数から導出されます。

- フルノード(ステーク0ETH)：4 Subnet
- ソロバリデータ(ステーク32ETH)：8 Subnet
- 中型バリデータ(ステーク2048ETH)：64 Subnet
- 大型バリデータ(ステーク4096ETH)：128 Subnet(全Subnet)

全ての Subnet のデータを提供するノードを、PeerDASについて、Supernodeと呼びます。また中型バリデータは64 Subnet となっており、前提で述べたように、消失訂正符号を含んでいるため、中型バリデータ以上は全 Subnet データを復元できます。

#### コンセンサスのステップに従ったノードのPeerDAS処理

PeerDASは、ビーコンチェーンで次のように処理される。フェーズには、ターゲットタイムが指定されており、ブロック提案フェーズは4秒、

1. ブロックデータ生成・送信フェーズ(0~4秒)
   ブロックプロポーザーは全てのBlobデータを集約し、ブロックデータを生成します。その後、Gossipプロトコルでピアに共有します。- Blobデータをblob数の行×128列の行列に変換する - 64列はBlobデータ自体、64列は消失訂正符号とする - BlobごとにKZGコミットメント・KZG証明を発行する - ブロックデータ・Blobデータをピアに送信する
2. ブロックデータの受信・署名フェーズ(4~8秒)
   各ノードはブロックデータ及びBlobデータをGossipプロトコルでピアから受信します。次のような作業を各ノードが行います。
   - 各ノードは、自分のノードIDといくつの Subnet を保有しているかを共有する
   - 各ノードは、必要な Subnet に応じて、Gossipプロトコルでノードから Subnet のデータを送受信する
   - 各ノードは、BlobごとのKZGコミットメント・KZG証明を用いて、取得した Subnet データが、確かにそのBlobに含まれていることを検証する
     ※実際には、Blobごとに処理するのではなく、BlobごとのKZGコミットメント・証明データを結合し、まとめて検証する
   - 全データの検証が完了すれば、attestationを行う
   - クライアントによっては(ex. prysm)、必要な Subnet データのうち50%(64 Subnet )が集まれば、ピアのデータを待たず、残りの Subnet データを再生成する

1においては、ブロック・Blobデータの送信も含めて4秒内であることから、Blob数が増えれば増えるほど、必要となるリソース（特に帯域幅）が増大します。例えば、現在のスケジュールにおいては、2026/1/7にBlobの最大数は21に到達します。この場合、3秒以内に単独のピアに全データを送信するためには、21(blob) \* 256(kB/blob) / 3(s) = 1792(kB/s) = 14Mbps が最低限必要です。当然、単独のピアだけではなく、複数のピアにデータを送信するでしょうから、100Mbps程度はBlobデータのみで消費されることとなります。

保有・検証するデータについては、PeerDASのおかげで、従来の実装に比べ少なくなりましたが、帯域幅については従来の実装より増加していることに留意が必要です。

下図は上の計算手法において、ブロックプロポーザーが、3秒以内に8つのピアにBlobデータを送信することを想定したときのBlob数ごとに必要となる帯域幅を示しています。

![バリデータに必要となる帯域幅](/images/peerdas03.png)

## 重要なEIPの詳細

### Blob容量上限の上昇・段階的なBlobアップデート（EIP-7892）

Pectraの実装(2025/5/7)以降、blobのターゲット数（最低手数料で利用できる数）は6つとなっており、直近においては、相場の急変動もあり、90%以上の利用率（説明要）となっています。追加の手数料を払うことで、最大9個までのblobを同一ブロックに格納できるようになっており、L2の活用の発展・ブロックスペースの効率的な利用においては、Blobの上限数・ターゲット数を共に増加させる必要があります。下の図は、4月14日以降の日次でのBlob利用率を示したものです。42Kに赤線を入れているのは、blobのターゲット数×1日のethereumブロック数での、1日のターゲットblob数を示すためです。徐々に日次でのターゲットblob数には近づいてきているのが見て取れるかと思います。
![Blob利用の推移](/images/dailyblobcount.png)

そこで今回実装されるのが、Blobのパラメータのみを更新する新たな種類のフォーク Blob Parameter Only Hardforks(BPOと呼ぶ)です。BPOにより、以下のスケジュールでBlobのターゲット・最大値等のパラメータは段階的に上げられることになります。従来のハードフォークタイミングよりも高速にパラメータを上げていくことで、市場の拡大にも耐えつつFusakaアップデート・BPOの影響をモニタしながら、パラメータを上げていくためです。PeerDASの実装に伴い、よりBlobのターゲット・最大値を大きくできるようになったため、Fusakaアップデートに組み込まれています。

現時点では、次のスケジュールで、パラメータを更新していく予定です。

| アップデート名 | タイムスタンプ (JST)   | ターゲット | 最大値 |
| -------------- | ---------------------- | ---------- | ------ |
| Cancun         | -                      | 3          | 6      |
| Prague         | -                      | 6          | 9      |
| Fusaka         | 2025-12-04 06:49 (JST) | 6          | 9      |
| BPO1           | 2025-12-18 22:29 (JST) | 10         | 15     |
| BPO2           | 2026-01-07 10:01 (JST) | 14         | 21     |

### ブロックガス上限の上昇/トランザクションガス制限（EIP-7935 & EIP-7825）

Ethereumのブロックガス上限は、07月21日に45Mに引き上げられたばかりです。直近においては、平均ガス利用率は下図の通り50%ほどとなっており、トランザクション処理には余裕がある現状です。
![ガス利用量の推移](/images/average-gas-usage.png)

しかしながら、ブロックによって利用率90%を超えており、下図の6か月間の平均ガス価格からもわかるように、ガス代にも影響が出ていることに変わらず継続した取り組みとなっています。
![ガス代の平均値推移](/images/average-gas-price.png)

Fusakaアップデートでは、**ブロックガス上限を60Mに引き上げます**(EIP-7935)。当然のことながら、この引き上げにより、スループットの向上、ガス価格の安定化が見込まれます。

このアップデートに組み合わせ、**トランザクションごとにガス制限を適用する(EIP-7825)**ことで、ブロックガス上限の緩和効果を最大化しようとしています。このガス制限は、単一のトランザクションで約17Mガス(2^24ガス、現行におけるブロックガスの1/3以上に相当)以上消費できないことをプロトコルのルールにすることで適用されます。

コントラクト開発者においては、もしこの制限を超えるようなトランザクションを想定している場合は、コントラクトの再設計が必要となるので、注意してください。

### コントラクト容量上限の上昇（EIP-7907）

EIP-170(2017年)以降、スマートコントラクトのコードサイズ上限は**24KB**に制限されてきました。もともと、DoS攻撃を防ぐ目的で上限を設定していましたが、dAppsが複雑化してきていることもあり、開発者UXの向上を目的としてコードサイズ上限を48kBに上げることとなりました。

コードサイズ上限が上がることで、開発者としては、これまで必要なかったコントラクトの分割によるコントラクト間呼び出し等の実装コストが下がります。

しかし、24kBを超えるコントラクトについては、従来のコントラクトに比べてノードリソースも含めかかることから、32バイトあたり2ガスが追加でかかるようになっています。

まとめると、以下のように仕様が変更されます。

| 項目       | 現行（EIP-170） | Fusaka後（EIP-7907）       |
| ---------- | --------------- | -------------------------- |
| 最大サイズ | 24 KB           | 48 KB                      |
| 追加コスト | なし            | 24KB超過分：2ガス/32バイト |

### そのほか特記するべき、将来につながるアップデート項目

#### EIP-7917 ブロックプロポーザーの事前決定

従来、次エポック(1エポック=32block ~ 6.4分)におけるプロポーザーは必ずしも確定していませんでした。そのため、近年話題になっている Preconfirmation（指定のトランザクションを指定のタイミングに確実に通すことを確証する技術）においても、この点が障害になると考えられていましたが、Fusakaアップデートにおいて次エポックにおけるプロポーザーを事前に確定するため対応できることになりました。

こちらは、すぐに効果が出るのではなく、将来的なUX改善に向けた打ち手になります。

## バリデータ・フルノード運用者、L2・コントラクト開発者への影響とまとめ

### バリデータ・フルノード運用者への影響

Fusakaアップデートにより、以下のノード運用者に影響のあるEIPが実装されます。特に、①PeerDAS（EIP-7935 & EIP-7825）②Blob容量上限の上昇・段階的なBlobアップデート（EIP-7892）は、ノードのストレージ利用量・通信における帯域幅消費に影響します。また、eth/69のレシートデータの簡易化(EIP-7642)によって、不要なデータを返さない仕様となっており、帯域幅消費が縮小されることが見込まれます。

PeerDASの実装により、Fusakaアップデート後では、ステーク量が少ないバリデータは性能要件が緩和されると考えられています。逆に、多数のバリデータもしくは多数のETHをステークするバリデータについては、要件が厳しくなる可能性があります。
下図は、複数のステーク量タイプにおける、ストレージ利用(Blob関連のみ)、ブロック提案時のデータ送信速度を示しています。

320ETHをステークしているバリデータのBlob数ごとのストレージ利用量
![バリデータに必要となる帯域幅](/images/peerdas04.png)
1024ETHをステークしているバリデータのBlob数ごとのストレージ利用量
![バリデータに必要となる帯域幅](/images/peerdas05.png)
320ETHをステークしているバリデータのBlob数ごとのブロック提案時のデータ送信速度
![バリデータに必要となる帯域幅](/images/peerdas06.png)
1024ETHをステークしているバリデータのBlob数ごとのブロック提案時のデータ送信速度
![バリデータに必要となる帯域幅](/images/peerdas07.png)

~320ETHまでのステークにおいては、20Blobを超えたとしても、ストレージ利用量はFusakaアップデートより依然として低くなっています。問題となるのは、ブロック提案時の帯域幅です。ブロック提案においては、全Blobデータを集約し、署名のためピアに提供しなければならないため、Blob数が増えるほど帯域幅が必要となります。一部のクライアントにおいては、ELからBlobデータを受信して処理するなどの仕組みが実装されていたり、`--max-blobs` のような上限blob数を既定するフラグを実装している場合があるため、帯域幅の制限が想定される場合は、クライアントの機能をよく確認されることをお勧めします。

### Layer2開発者への影響

Fusakaアップデートにより、以下のLayer2開発に影響のあるEIPが実装されます。特に、①PeerDAS（EIP-7935 & EIP-7825）②Blob容量上限の上昇・段階的なBlobアップデート（EIP-7892）は、Layer2のDAであるblobの容量・コストに直結するため、Layer2のコスト・スループットに影響します。その他、EIP-7939のような、ZK Rollupの構築者にとっては利点の高いEIPが実装されます。

| EIP      | 機能                                           | 開発者への影響                                                                |
| -------- | ---------------------------------------------- | ----------------------------------------------------------------------------- |
| EIP-7939 | CLZオペコードの追加                            | ZK Rollup等、特定のユースケースに対して、実装・ガスコストが効率化             |
| EIP-7951 | secp256r1のプレコンパイルコントラクトの追加    | UXの変更なしに、既存のSecp256r1プリコンパイルコントラクトが修正される         |
| EIP-7883 | MODEXPのガスコスト増加                         | RSA/ZK暗号化オペレーションのガスコスト削減                                    |
| EIP-7594 | PeerDAS                                        | 現行のUXを変更せず、Blobのスケーリングが可能に                                |
| EIP-7892 | Blob Parameter Only ハードフォーク             | 現行のハードフォークよりも高速に、Blobのターゲット・最大値が変更可能に        |
| EIP-7907 | コントラクトサイズの計測及び上限の緩和         | コントラクトのマージ等、構成を最適化可能となる                                |
| EIP-7918 | ブロックのベースガス料金とBlobベース料金を連動 | Blobのベース料金がブロックのベースガス料金により変動                          |
| EIP-7917 | ブロックプロポーザーの事前決定                 | 次エポックのブロックプロポーザーが事前に確定できるため、Preconfirmationに寄与 |

### スマートコントラクト開発者への影響

Fusakaアップデートにより、以下のスマートコントラクト開発に影響のあるEIPが実装されます。特に、①ブロックガス上限の上昇/トランザクションガス制限（EIP-7935 & EIP-7825）②コントラクト容量上限の上昇（EIP-7907）③secp256r1が実装されます。多くのコントラクトに影響はありませんが、もし非常に複雑なコントラクトを構築していて、トランザクションごとのガスリミットを超えてしまうような場合は、機能の分割等の影響が見込まれます。

| EIP番号  | 名称                                   | 開発者への影響                                                                                                                             |
| -------- | -------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
| EIP-7935 | デフォルトガスリミットを60Mに設定      | より多くのトランザクションを同一ブロックに投入できる可能性が高まる                                                                         |
| EIP-7825 | トランザクションごとのガスリミット上限 | もし非常に複雑なコントラクトを構築しており、単一トランザクションのガス消費が16,777,216ガスを上回る場合、分割が必要                         |
| EIP-7907 | コントラクトサイズの計測及び上限の緩和 | コントラクトコードサイズを最大倍にできるため、従来容量が理由で分割する必要があったコントラクトをマージ可能に（24KBの超過分はガス費用増加） |
| EIP-7823 | MODEXPへの入力値上限設定               | MODEXPのプリコンパイルコントラクトに入力値制限(1024バイト)が設定                                                                           |
| EIP-7883 | MODEXPのガスコスト増加                 | MODEXPに関するガスコストが引き上げ・修正                                                                                                   |
| EIP-7939 | CLZオペコードの追加                    | CLZオペコードを追加し、ゼロ知識証明等の実装・計算コストを低減                                                                              |

### まとめ

Fusakaアップグレードは、Ethereumのスケーラビリティにおいて非常に大きなハードフォークです。特に大きなものとして、PeerDASが取り上げられることが多いですが、上で各ステークホルダーへの影響を記載したように、細かなUX改善も数多く含まれています。また、将来的なTPS拡大、Preconfirmation等を通した利用者にとってのUXの改善など、未来を見据えた改善も数多く含まれています。

### 参考文献

本稿は、以下の参考資料を元に作成しています。詳しく理解したいほうは、こちらをご確認ください。
**適切な引用形式に修正中です**

1. Emmanuel nalepa, <https://hackmd.io/@manunalepa/peerDAS/https%3A%2F%2Fhackmd.io%2Fe3UGeZ7cS92uk8b1SeVSyw#With-managed-validators-validator-custody>
1. <https://ethereum.org/ja/roadmap/fusaka/peerdas/#peer-das>
1. <https://blog.sigmaprime.io/peerdas-distributed-blob-building.html?utm_source=chatgpt.com>
1. <https://ethpandaops.io/posts/fusaka-bandwidth-estimation>
1. <https://ethpandaops.io/posts/fusaka-devnet-5-bpo-analysis>
1. <https://medium.com/gaudiy-web3-lab/3ace46a3a9af>
1. <https://www.paradigm.xyz/2023/04/mev-boost-ethereum-consensus>
1. <https://hackmd.io/@manunalepa/peerDAS/https%3A%2F%2Fhackmd.io%2F%40manunalepa%2Frytr6f5zJe>
